name: 自动更新 live.txt 到 GitHub Pages

on:
  push:
    paths:
      - 'live.txt'  # 仅当 live.txt 改动时触发

jobs:
  update-pages:
    runs-on: ubuntu-latest

    steps:
      # 1. 拉取仓库
      - name: Checkout 仓库
        uses: actions/checkout@v3

      # 2. 设置 Git 用户信息
      - name: 设置 Git
        run: |
          git config --local user.name "github-actions[bot]"
          git config --local user.email "github-actions[bot]@users.noreply.github.com"

      # 3. 检查 live.txt 改动
      - name: 检查 live.txt 改动
        id: check_changes
        run: |
          git add live.txt
          if git diff --cached --quiet; then
            echo "changed=false" >> $GITHUB_OUTPUT
          else
            echo "changed=true" >> $GITHUB_OUTPUT
          fi

      # 4. 提交并 push 改动（仅当 live.txt 改动时）
      - name: 提交更新
        if: steps.check_changes.outputs.changed == 'true'
        run: |
          git commit -m "📡 live.txt 自动更新 $(date '+%Y-%m-%d %H:%M:%S')"
          git push origin main
